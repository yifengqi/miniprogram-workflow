# 🤖 全自动化工作流设计方案 v3.0

**设计日期**：2026-02-06  
**设计理念**：遵循标准化开发流程，实现AI自动化，您只需做决策

---

## 🎯 核心目标

让您的角色从"执行者"变为"决策者"：
- ✅ 您只需要：筛选需求、确认方案、验收成果
- ✅ AI 自动：生成PRD、生成代码、执行测试、记录经验

---

## 📋 标准化流程回顾

```
阶段0：知识库加载（AI自动读取经验）
  ↓
阶段1：需求收集（客户填表单）
  ↓
阶段2：PRD生成（AI自动生成双版本PRD）
  ↓
阶段3：Demo开发（AI自动生成可运行代码）
  ↓
阶段4：确认与迭代（客户反馈 → AI自动修改）
  ↓
阶段5：功能完善（AI自动完善+检查清单）
```

---

## 🔄 全自动化实现方案

### 现状分析

**✅ 已完成自动化**：
- 阶段0：知识库已内置在应用中 ✅
- 阶段1：客户可在线填写需求表单 ✅
- 需求池：您可筛选和立项 ✅

**❌ 需要补充自动化**：
- 阶段2：PRD生成需要手动点击两次按钮
- 阶段3：Demo开发目前没有实现
- 阶段4：迭代流程没有实现
- 阶段5：功能完善和检查清单是独立页面

---

## 🚀 全自动化改造方案

### 方案1：一键式自动化（推荐）⭐

**核心思路**：立项后触发自动流水线

```
需求池立项 
  ↓ 自动触发
客户版PRD生成（AI）
  ↓ 自动确认
开发版PRD生成（AI）
  ↓ 【您的决策点1】
  ↓ 确认PRD → 继续 / 修改PRD → 返回
  ↓ 自动触发
Demo代码生成（AI）
  ↓ 【您的决策点2】
  ↓ 确认Demo → 继续 / 修改Demo → 返回
  ↓ 自动触发
非功能性检查（AI）
  ↓ 【您的决策点3】
  ↓ 确认完成 → 交付 / 继续优化 → 返回
```

**您的操作**：
1. 在需求池点击"立项" → 开始自动化
2. 查看生成的PRD → 确认或修改
3. 查看生成的Demo → 确认或修改
4. 查看检查清单 → 确认完成

**优点**：
- 全程自动，您只需做3次关键决策
- 严格遵循标准化流程
- 每个阶段都有输出物

---

### 方案2：智能看板式（备选）

**核心思路**：将项目看作任务卡片，AI自动推进

```
看板列：
┌──────────┬──────────┬──────────┬──────────┬──────────┐
│ 需求池    │ PRD生成  │ Demo开发 │ 迭代优化 │ 待交付   │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 项目A ✋  │ 项目B 🤖 │ 项目C 🤖 │ 项目D 🤖 │ 项目E ✅ │
│          │          │          │          │          │
│ (手动筛选)│ (AI进行) │ (AI进行) │ (AI进行) │ (已完成) │
└──────────┴──────────┴──────────┴──────────┴──────────┘
```

**优点**：
- 可视化管理多个项目
- 清楚知道每个项目的进度
- AI自动推进，无需干预

---

## 💻 技术实现设计

### 核心功能：AI自动化引擎

#### 1. 项目状态机

```javascript
// src/stores/project.js

const PROJECT_STAGES = {
  requirement: '需求收集',    // 刚立项
  prd_generating: 'PRD生成中',
  prd_ready: 'PRD待确认',     // 【决策点1】
  demo_generating: 'Demo生成中',
  demo_ready: 'Demo待确认',   // 【决策点2】
  iteration: '迭代优化',      // 【决策点3】
  checklist: '最终检查',
  completed: '已完成'
}

// 自动化流水线
async function autoProgressProject(projectId) {
  const project = getProjectById(projectId)
  
  switch(project.stage) {
    case 'requirement':
      await autoGeneratePRD(project)
      break
    case 'prd_ready':
      // 等待您的确认
      break
    case 'demo_generating':
      await autoGenerateDemo(project)
      break
    // ... 其他阶段
  }
}
```

#### 2. AI任务队列

```javascript
// src/utils/aiQueue.js

class AITaskQueue {
  constructor() {
    this.queue = []
    this.running = false
  }
  
  // 添加任务
  addTask(projectId, taskType, priority = 'normal') {
    this.queue.push({ projectId, taskType, priority })
    this.process()
  }
  
  // 自动执行队列
  async process() {
    if (this.running) return
    this.running = true
    
    while (this.queue.length > 0) {
      const task = this.queue.shift()
      await this.executeTask(task)
    }
    
    this.running = false
  }
  
  // 执行具体任务
  async executeTask(task) {
    switch(task.taskType) {
      case 'generate_prd_client':
        await generateClientPRD(task.projectId)
        await this.addTask(task.projectId, 'generate_prd_dev')
        break
      case 'generate_prd_dev':
        await generateDevPRD(task.projectId)
        await updateProjectStage(task.projectId, 'prd_ready')
        break
      case 'generate_demo':
        await generateDemoCode(task.projectId)
        await updateProjectStage(task.projectId, 'demo_ready')
        break
      // ... 其他任务
    }
  }
}

export const aiQueue = new AITaskQueue()
```

#### 3. 自动化触发器

```javascript
// src/stores/requirementPool.js

// 立项时自动触发
function acceptRequirement(requirementId, projectId) {
  // ... 现有逻辑
  
  // ⭐ 新增：自动启动AI流水线
  aiQueue.addTask(projectId, 'generate_prd_client', 'high')
  
  // 更新项目状态
  updateProjectStage(projectId, 'prd_generating')
}
```

---

## 📄 页面改造方案

### 1. 项目详情页（新增）⭐

**位置**：点击首页项目卡片进入

**布局**：
```
┌─────────────────────────────────────────────┐
│ 项目名称：XXX小程序                           │
│ 当前阶段：Demo开发中 🤖                      │
│ 预计完成：2天后                              │
├─────────────────────────────────────────────┤
│                                             │
│ 【进度条】                                   │
│ ●━━━━●━━━━●━━━━○━━━━○                      │
│ 需求  PRD  Demo  迭代  完成                  │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│ 【阶段输出物】                               │
│                                             │
│ ✅ 需求信息                                  │
│    查看完整需求 →                            │
│                                             │
│ ✅ 客户版PRD                                │
│    预览 | 编辑 | 下载                        │
│                                             │
│ ✅ 开发版PRD                                │
│    预览 | 编辑 | 下载                        │
│                                             │
│ 🤖 Demo代码（生成中...）                     │
│    [进度] ████░░░░░░ 40%                    │
│                                             │
│ ○ 迭代记录（未开始）                         │
│                                             │
│ ○ 检查清单（未开始）                         │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│ 【决策区域】                                 │
│ [继续下一步] [暂停自动化] [标记问题]         │
│                                             │
└─────────────────────────────────────────────┘
```

### 2. PRD页面改造

**当前问题**：需要手动点击"生成客户版"→"生成开发版"

**改造方案**：
```vue
<!-- 自动化模式 -->
<div v-if="autoMode" class="auto-generation">
  <el-alert type="info" :closable="false">
    AI正在自动生成PRD，您可以随时查看进度
  </el-alert>
  
  <el-steps :active="currentStep" finish-status="success">
    <el-step title="客户版PRD" :description="step1Desc" />
    <el-step title="开发版PRD" :description="step2Desc" />
    <el-step title="等待确认" :description="step3Desc" />
  </el-steps>
  
  <!-- 实时预览 -->
  <div class="live-preview">
    <h4>实时生成内容预览</h4>
    <div class="markdown-preview">
      {{ generatingContent }}
    </div>
  </div>
</div>

<!-- 手动模式（保留） -->
<div v-else class="manual-mode">
  <!-- 现有的手动生成按钮 -->
</div>
```

### 3. Demo开发页（新增）⭐

**页面路由**：`/demo`

**功能**：
```vue
<template>
  <div class="demo-page">
    <h1>Demo 自动生成</h1>
    
    <!-- 状态显示 -->
    <div class="generation-status">
      <el-icon class="loading"><Loading /></el-icon>
      <h3>AI正在根据PRD生成Demo代码...</h3>
      <p>预计需要3-5分钟</p>
    </div>
    
    <!-- 生成进度 -->
    <el-timeline>
      <el-timeline-item timestamp="刚刚" type="success">
        解析开发版PRD
      </el-timeline-item>
      <el-timeline-item timestamp="1分钟前" type="success">
        生成项目框架
      </el-timeline-item>
      <el-timeline-item timestamp="进行中" type="primary">
        生成页面组件（3/7）
      </el-timeline-item>
      <el-timeline-item type="info">
        生成数据库云函数
      </el-timeline-item>
      <el-timeline-item type="info">
        生成配置文件
      </el-timeline-item>
    </el-timeline>
    
    <!-- 代码预览 -->
    <div class="code-preview">
      <el-tabs>
        <el-tab-pane label="文件列表">
          <el-tree :data="fileTree" />
        </el-tab-pane>
        <el-tab-pane label="关键代码">
          <pre><code>{{ demoCode }}</code></pre>
        </el-tab-pane>
      </el-tabs>
    </div>
    
    <!-- 操作按钮 -->
    <div class="actions">
      <el-button type="primary" @click="confirmDemo">
        确认Demo，进入迭代
      </el-button>
      <el-button @click="regenerateDemo">
        重新生成
      </el-button>
      <el-button @click="editDemo">
        手动调整
      </el-button>
    </div>
  </div>
</template>
```

### 4. 迭代优化页（新增）⭐

**页面路由**：`/iteration`

**功能**：
```vue
<template>
  <div class="iteration-page">
    <h1>迭代优化</h1>
    
    <!-- 反馈收集 -->
    <el-card title="客户反馈">
      <el-form>
        <el-form-item label="反馈内容">
          <el-input 
            type="textarea" 
            v-model="feedback"
            placeholder="粘贴客户的反馈或问题"
          />
        </el-form-item>
        <el-button type="primary" @click="submitFeedback">
          提交给AI分析
        </el-button>
      </el-form>
    </el-card>
    
    <!-- AI自动分析 -->
    <el-card title="AI分析结果" v-if="analysis">
      <el-table :data="analysis.issues">
        <el-table-column prop="type" label="类型" />
        <el-table-column prop="priority" label="优先级" />
        <el-table-column prop="description" label="问题描述" />
        <el-table-column prop="solution" label="建议方案" />
        <el-table-column label="操作">
          <template #default="{ row }">
            <el-button 
              type="primary" 
              size="small"
              @click="autoFix(row)"
            >
              自动修复
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
    
    <!-- 迭代记录 -->
    <el-card title="迭代历史">
      <el-timeline>
        <el-timeline-item 
          v-for="record in iterationHistory" 
          :key="record.id"
          :timestamp="record.time"
        >
          {{ record.description }}
        </el-timeline-item>
      </el-timeline>
    </el-card>
  </div>
</template>
```

---

## 🎨 全新的首页设计（项目看板）

```vue
<template>
  <div class="dashboard-page">
    <h1>项目看板</h1>
    
    <!-- 统计卡片 -->
    <div class="stats-cards">
      <el-card>
        <statistic title="待评估需求" :value="poolStore.pendingCount" />
      </el-card>
      <el-card>
        <statistic title="AI处理中" :value="aiProcessingCount" />
      </el-card>
      <el-card>
        <statistic title="待您决策" :value="pendingDecisionCount" />
      </el-card>
      <el-card>
        <statistic title="已完成" :value="completedCount" />
      </el-card>
    </div>
    
    <!-- 看板视图 -->
    <div class="kanban-board">
      <!-- 需求池 -->
      <div class="kanban-column">
        <h3>需求池</h3>
        <div class="project-cards">
          <div 
            v-for="req in poolStore.pendingRequirements" 
            :key="req.id"
            class="project-card"
          >
            <h4>{{ req.quickInfo.appName }}</h4>
            <p>{{ req.data.budget }}</p>
            <el-button @click="acceptReq(req)">立项</el-button>
          </div>
        </div>
      </div>
      
      <!-- PRD生成中 -->
      <div class="kanban-column">
        <h3>PRD生成 🤖</h3>
        <div class="project-cards">
          <div 
            v-for="proj in prdGeneratingProjects" 
            :key="proj.id"
            class="project-card processing"
          >
            <h4>{{ proj.name }}</h4>
            <el-progress :percentage="proj.progress" />
            <p>AI正在处理...</p>
          </div>
        </div>
      </div>
      
      <!-- PRD待确认 -->
      <div class="kanban-column highlight">
        <h3>待您确认 ✋</h3>
        <div class="project-cards">
          <div 
            v-for="proj in prdReadyProjects" 
            :key="proj.id"
            class="project-card decision"
          >
            <h4>{{ proj.name }}</h4>
            <el-button type="primary">查看PRD</el-button>
          </div>
        </div>
      </div>
      
      <!-- Demo生成中 -->
      <div class="kanban-column">
        <h3>Demo开发 🤖</h3>
        <div class="project-cards">
          <!-- ... -->
        </div>
      </div>
      
      <!-- 已完成 -->
      <div class="kanban-column">
        <h3>已完成 ✅</h3>
        <div class="project-cards">
          <!-- ... -->
        </div>
      </div>
    </div>
  </div>
</template>
```

---

## 🔌 AI接口增强

### 新增AI能力

```javascript
// src/api/ai.js

// 1. 自动生成Demo代码
export async function generateDemoCode(prdContent) {
  const prompt = `
请根据以下PRD开发版内容，生成一个完整的小程序Demo代码。

要求：
1. 使用微信小程序原生框架
2. 包含所有必需的页面和组件
3. 实现核心业务逻辑
4. 包含完整的云函数代码
5. 生成项目配置文件

PRD内容：
${prdContent}

请按照以下格式输出：
## 文件结构
## 代码文件
### pages/index/index.js
### pages/index/index.wxml
...
`
  
  return await callAI(prompt)
}

// 2. 自动分析客户反馈
export async function analyzeFeedback(feedback, currentDemo) {
  const prompt = `
你是一个项目经理助手，请分析客户的反馈并提供修改建议。

客户反馈：
${feedback}

当前Demo情况：
${currentDemo}

请分析：
1. 反馈类型（bug/需求变更/UI调整/性能问题）
2. 优先级（P0/P1/P2）
3. 具体问题描述
4. 建议修改方案
5. 预计工作量

输出JSON格式。
`
  
  return await callAI(prompt)
}

// 3. 自动执行非功能性检查
export async function runChecklistAuto(projectInfo) {
  const prompt = `
请对以下项目进行非功能性检查，参考标准检查清单。

项目信息：
${JSON.stringify(projectInfo)}

检查清单位于：@标准化开发流程/06_非功能性检查清单.md

请逐项检查并输出：
1. 检查项
2. 是否通过
3. 如果不通过，给出具体问题和修改建议
`
  
  return await callAI(prompt)
}
```

---

## 📊 实施优先级

### Phase 1：核心自动化（1周）⭐

1. ✅ 项目状态机设计
2. ✅ AI任务队列实现
3. ✅ 立项自动触发PRD生成
4. ✅ PRD自动化流程（客户版→开发版）
5. ✅ 项目详情页开发

### Phase 2：Demo自动化（2周）

1. ⏳ Demo代码生成AI能力
2. ⏳ Demo生成页面
3. ⏳ 代码预览和下载
4. ⏳ 确认和重新生成流程

### Phase 3：迭代自动化（1周）

1. ⏳ 客户反馈AI分析
2. ⏳ 迭代优化页面
3. ⏳ 自动修复机制
4. ⏳ 迭代历史记录

### Phase 4：看板和完善（1周）

1. ⏳ 看板式首页
2. ⏳ 自动检查清单
3. ⏳ 项目统计和报表
4. ⏳ 全流程测试和优化

---

## 🎯 最终效果

**您的工作流程**：
```
1. 早上打开网站
   → 看到5个新需求在需求池
   
2. 浏览需求，点击"立项"3个
   → AI自动开始生成PRD
   
3. 喝杯咖啡回来（10分钟）
   → 3个项目的PRD都生成好了
   → 看板显示"待您确认"
   
4. 逐个查看PRD，点击"确认"
   → AI自动开始生成Demo代码
   
5. 中午吃饭回来
   → 3个Demo都生成好了
   → 下载代码包，测试运行
   
6. 发给客户试用，收集反馈
   → 粘贴反馈到"迭代优化"页
   → AI自动分析，给出修改建议
   → 点击"自动修复"
   
7. 第二天查看
   → 所有修改都完成了
   → 看板显示"已完成"
   → 点击"交付"，项目结束
```

**时间对比**：
- 传统方式：每个项目需要1-2周，人工参与度80%
- 自动化后：每个项目需要2-3天，人工参与度20%
- **效率提升**：可同时处理5-10个项目！

---

## 💡 设计亮点

1. **完全遵循标准化流程**
   - 5个阶段一个不少
   - 经验知识库自动应用

2. **您只做关键决策**
   - 筛选需求：在需求池立项
   - 确认方案：PRD和Demo
   - 验收成果：最终检查

3. **AI做所有执行工作**
   - 生成文档
   - 生成代码
   - 分析反馈
   - 执行修改

4. **可视化管理**
   - 看板清楚显示进度
   - 实时显示AI处理状态
   - 需要决策的项目高亮

5. **可随时干预**
   - 可暂停自动化
   - 可手动编辑任何内容
   - 可切换回手动模式

---

## 🤔 需要确认的问题

### 1. Demo代码生成方式

**选项A**：AI生成纯文本代码，您下载后手动创建文件  
**选项B**：AI生成+系统自动创建本地项目文件夹（需要更多权限）  
**选项C**：AI生成+直接推送到GitHub仓库（需要GitHub集成）  

**推荐**：选项A（简单可靠）

### 2. 自动化程度

**选项A**：完全自动，除了3个决策点，不需要任何操作  
**选项B**：半自动，每个阶段完成后通知您，您决定是否继续  
**选项C**：可配置，您可以设置哪些阶段自动哪些手动  

**推荐**：选项C（灵活性最高）

### 3. 实施方式

**选项A**：一次性实现所有功能（需要2-3周）  
**选项B**：分阶段实现，先做核心自动化（1周），再逐步完善  
**选项C**：最小化实现，先让一个完整流程自动化，再扩展  

**推荐**：选项B（平衡速度和质量）

---

## 📝 下一步行动

**请您告诉我**：

1. ✅ 您同意这个全自动化方案吗？
2. ✅ 对Demo代码生成方式的选择？（A/B/C）
3. ✅ 对自动化程度的选择？（A/B/C）
4. ✅ 对实施方式的选择？（A/B/C）

**确认后我将**：
1. 立即开始实施Phase 1（核心自动化）
2. 修改项目状态机
3. 实现AI任务队列
4. 改造立项流程触发自动化
5. 测试完整流程

---

**预计完成时间**：Phase 1 约2小时（今天就能看到效果！）  
**您将看到**：立项后自动生成PRD，无需手动点击按钮！🚀
