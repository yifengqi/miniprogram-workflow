# 需求池流程改造方案 - v2.0

**更新时间**：2026-02-06  
**改造类型**：重大功能重构

---

## 📋 改造目标

### 核心变化
- ❌ 删除手动创建项目功能
- ✅ 所有项目从需求池立项
- ✅ 需求表单添加联系方式、预算、期望时间（选填）
- ✅ 清空现有项目数据，从零开始

### 新工作流程
```
发送空白需求表单
    ↓
客户填写提交（支持选填联系方式、预算、期望时间）
    ↓
自动进入需求池（状态：待评估）
    ↓
查看需求详情，决定是否立项
    ↓
点击「立项」→ 自动创建项目 + 跳转PRD生成
    ↓
生成PRD → 开始开发
```

---

## 🗂️ 数据结构设计

### 1. 需求池数据（localStorage: requirement-pool）

```javascript
[
  {
    id: 'req-20260206-001',
    submittedAt: '2026-02-06T10:00:00',
    status: 'pending',  // pending | accepted | rejected
    
    // 需求表单数据
    data: {
      // 基本信息
      background: '',
      appName: '',
      appType: [],
      appTypeOther: '',
      
      // 联系方式（选填）⭐ 新增
      contact: '',  // 手机号或微信
      
      // 预算和时间（选填）⭐ 新增
      budget: '',   // 如：5000-10000元
      expectedTime: '',  // 如：2个月内
      
      // 其他所有需求收集字段...
      targetUser: '',
      userScenario: '',
      featuresP0: '',
      // ... 完整的需求数据
    },
    
    // 管理信息
    projectId: null,  // 立项后关联的项目ID
    notes: '',  // 评估备注
    tags: [],  // 标签：['紧急', '高预算', '长期项目']
    
    // 快速信息（用于列表显示）
    quickInfo: {
      appName: '抢票小程序',
      budget: '5000-10000元',
      contact: '138****8888',
      hasContact: true,
      hasBudget: true,
      hasTime: true
    }
  }
]
```

### 2. 项目数据（localStorage: projects）⭐ 简化

```javascript
[
  {
    id: 'project-xxx',
    name: '抢票小程序',
    createdAt: Date,
    updatedAt: Date,
    
    // 关联需求
    requirementId: 'req-20260206-001',  // ⭐ 关联需求池ID
    requirement: { /* 完整需求数据 */ },
    
    // PRD
    prdClient: '',
    prdDev: '',
    
    // 状态
    status: 'requirement',  // requirement | prd-generated | in-development
  }
]
```

---

## 🎨 页面改造

### 1. 新增：需求池页面（RequirementPool.vue）

**路由**：`/requirement-pool`

**主要功能**：
```vue
<template>
  <div class="requirement-pool-page">
    <!-- 顶部操作栏 -->
    <div class="page-header">
      <h1>需求池</h1>
      <el-button type="primary" @click="shareForm">
        <el-icon><Share /></el-icon>
        分享需求表单
      </el-button>
    </div>
    
    <!-- 状态筛选 -->
    <el-tabs v-model="activeTab">
      <el-tab-pane label="待评估" name="pending">
        <el-badge :value="pendingCount" />
      </el-tab-pane>
      <el-tab-pane label="已立项" name="accepted" />
      <el-tab-pane label="已拒绝" name="rejected" />
    </el-tabs>
    
    <!-- 需求列表 -->
    <div class="requirements-list">
      <div v-for="req in filteredRequirements" class="requirement-card">
        <!-- 状态指示器 -->
        <div class="status-badge" :class="req.status" />
        
        <!-- 基本信息 -->
        <h3>{{ req.data.appName || '未命名项目' }}</h3>
        <div class="meta">
          <span v-if="req.quickInfo.contact">
            📞 {{ req.quickInfo.contact }}
          </span>
          <span v-if="req.quickInfo.budget">
            💰 {{ req.data.budget }}
          </span>
          <span v-if="req.data.expectedTime">
            ⏰ {{ req.data.expectedTime }}
          </span>
          <span>📅 {{ formatTime(req.submittedAt) }}</span>
        </div>
        
        <!-- 简要内容 -->
        <p class="summary">{{ getSummary(req.data) }}</p>
        
        <!-- 操作按钮 -->
        <div class="actions">
          <el-button @click="viewDetail(req)">查看详情</el-button>
          
          <el-button 
            v-if="req.status === 'pending'" 
            type="primary" 
            @click="acceptAndCreateProject(req)"
          >
            立项并生成PRD
          </el-button>
          
          <el-button 
            v-if="req.status === 'pending'"
            @click="reject(req)"
          >
            拒绝
          </el-button>
          
          <el-button 
            v-if="req.status === 'accepted'" 
            @click="goToProject(req.projectId)"
          >
            进入项目
          </el-button>
        </div>
      </div>
    </div>
  </div>
</template>
```

### 2. 修改：公共需求表单（PublicRequirement.vue）

**添加字段**（在第1步 - 项目基本信息之后）：

```vue
<!-- 步骤 1: 项目基本信息 -->
<div v-show="currentStep === 0">
  <!-- 原有字段 -->
  <el-form-item label="项目背景" required>...</el-form-item>
  <el-form-item label="小程序名称" required>...</el-form-item>
  <el-form-item label="小程序类型" required>...</el-form-item>
  
  <!-- ⭐ 新增字段 -->
  <el-divider content-position="left">联系方式（选填）</el-divider>
  
  <el-form-item label="您的联系方式">
    <el-input 
      v-model="form.contact" 
      placeholder="手机号或微信号，方便我们与您联系（选填）"
    />
    <div class="form-tip">填写后我们能更快与您沟通项目细节</div>
  </el-form-item>
  
  <el-form-item label="预算范围">
    <el-input 
      v-model="form.budget" 
      placeholder="如：5000-10000元（选填）"
    />
  </el-form-item>
  
  <el-form-item label="期望完成时间">
    <el-input 
      v-model="form.expectedTime" 
      placeholder="如：2个月内 或 3月底前（选填）"
    />
  </el-form-item>
</div>
```

### 3. 修改：首页（Home.vue）

**移除**：
- ❌ "新建项目"按钮

**修改为**：
```vue
<div class="home-page">
  <div class="page-header">
    <h1>小程序开发工作流</h1>
    <p>从需求池管理项目，专业化流程</p>
  </div>
  
  <!-- 快速入口 -->
  <div class="quick-actions">
    <el-card class="action-card" @click="$router.push('/requirement-pool')">
      <div class="card-icon">📋</div>
      <h3>需求池</h3>
      <p>管理客户需求，选择立项</p>
      <el-badge v-if="pendingCount > 0" :value="pendingCount" />
    </el-card>
    
    <el-card class="action-card" @click="shareForm">
      <div class="card-icon">📤</div>
      <h3>分享需求表单</h3>
      <p>发送给客户收集需求</p>
    </el-card>
  </div>
  
  <!-- 项目列表（已立项的） -->
  <div class="section">
    <h2>进行中的项目 ({{ projects.length }})</h2>
    <div v-if="projects.length === 0" class="empty-state">
      <p>还没有项目，去需求池看看有没有可以立项的需求吧</p>
      <el-button type="primary" @click="$router.push('/requirement-pool')">
        进入需求池
      </el-button>
    </div>
    <!-- 项目卡片列表 -->
  </div>
  
  <!-- 工作流程说明 -->
  <div class="workflow-guide">
    <h3>标准化流程</h3>
    <div class="steps">
      <div class="step">1. 分享需求表单给客户</div>
      <div class="step">2. 客户提交后进入需求池</div>
      <div class="step">3. 评估需求，决定立项</div>
      <div class="step">4. 生成PRD，开始开发</div>
    </div>
  </div>
</div>
```

### 4. 修改：侧边栏菜单（App.vue）

```vue
<el-menu>
  <el-menu-item index="/">
    <el-icon><HomeFilled /></el-icon>
    <span>首页</span>
  </el-menu-item>
  
  <!-- ⭐ 新增：需求池（替代原来的需求收集和客户提交） -->
  <el-menu-item index="/requirement-pool">
    <el-icon><Inbox /></el-icon>
    <span>需求池</span>
    <el-badge v-if="pendingCount > 0" :value="pendingCount" />
  </el-menu-item>
  
  <!-- 保留：PRD生成 -->
  <el-menu-item index="/prd">
    <el-icon><Document /></el-icon>
    <span>PRD生成</span>
  </el-menu-item>
  
  <!-- 保留：经验知识库 -->
  <el-menu-item index="/knowledge">
    <el-icon><Notebook /></el-icon>
    <span>经验知识库</span>
  </el-menu-item>
  
  <!-- 保留：检查清单 -->
  <el-menu-item index="/checklist">
    <el-icon><Checked /></el-icon>
    <span>检查清单</span>
  </el-menu-item>
  
  <!-- 保留：设置 -->
  <el-menu-item index="/settings">
    <el-icon><Setting /></el-icon>
    <span>设置</span>
  </el-menu-item>
</el-menu>
```

### 5. 删除/重构的页面

**删除**：
- ❌ `RequirementForm.vue`（需求收集） - 功能合并到需求池
- ❌ `Submissions.vue`（客户提交） - 功能合并到需求池

**保留**：
- ✅ `PublicRequirement.vue`（公共表单） - 修改添加字段
- ✅ `PRD.vue`（PRD生成） - 适配新的数据结构
- ✅ `Home.vue`（首页） - 改为需求池入口

---

## 🔄 核心功能流程

### 1. 分享需求表单

```javascript
function shareForm() {
  // 生成公共表单链接
  const url = window.location.origin + '/public-form'
  
  // 弹窗显示分享选项
  showShareDialog({
    url,
    title: '需求收集表单',
    features: ['复制链接', '生成二维码', '分享说明']
  })
}
```

### 2. 客户提交 → 进入需求池

```javascript
// PublicRequirement.vue
function submitForm() {
  const requirement = {
    id: `req-${Date.now()}`,
    submittedAt: new Date().toISOString(),
    status: 'pending',
    data: { ...form },
    projectId: null,
    notes: '',
    quickInfo: {
      appName: form.appName,
      budget: form.budget,
      contact: form.contact ? maskPhone(form.contact) : null,
      hasContact: !!form.contact,
      hasBudget: !!form.budget,
      hasTime: !!form.expectedTime
    }
  }
  
  // 保存到需求池
  const pool = JSON.parse(localStorage.getItem('requirement-pool') || '[]')
  pool.unshift(requirement)
  localStorage.setItem('requirement-pool', JSON.stringify(pool))
  
  ElMessage.success('提交成功！您的需求已收到')
  // 清空表单或跳转到成功页
}
```

### 3. 立项并创建项目

```javascript
// RequirementPool.vue
function acceptAndCreateProject(requirement) {
  ElMessageBox.confirm(
    `确认立项「${requirement.data.appName}」并生成PRD吗？`,
    '确认立项',
    {
      confirmButtonText: '确认立项',
      cancelButtonText: '取消',
      type: 'success'
    }
  ).then(() => {
    // 1. 创建项目
    const project = projectStore.createProjectFromRequirement(requirement)
    
    // 2. 更新需求状态
    requirement.status = 'accepted'
    requirement.projectId = project.id
    updateRequirement(requirement)
    
    // 3. 跳转到PRD生成页面
    projectStore.setCurrentProject(project.id)
    router.push('/prd')
    
    ElMessage.success('项目已创建，开始生成PRD')
  })
}
```

### 4. 拒绝需求

```javascript
function reject(requirement) {
  ElMessageBox.prompt('请输入拒绝原因（可选）', '拒绝需求', {
    confirmButtonText: '确认',
    cancelButtonText: '取消'
  }).then(({ value }) => {
    requirement.status = 'rejected'
    requirement.notes = value || '不符合接单条件'
    updateRequirement(requirement)
    ElMessage.success('已标记为拒绝')
  })
}
```

---

## 📦 Store 改造

### 修改：projectStore

```javascript
// src/stores/project.js
export const useProjectStore = defineStore('project', {
  state: () => ({
    projects: [],  // 只保留已立项的项目
    currentProjectId: null
  }),
  
  actions: {
    // ⭐ 新增：从需求创建项目
    createProjectFromRequirement(requirement) {
      const project = {
        id: `project-${Date.now()}`,
        name: requirement.data.appName || '未命名项目',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        requirementId: requirement.id,
        requirement: requirement.data,
        prdClient: '',
        prdDev: '',
        status: 'requirement'
      }
      
      this.projects.unshift(project)
      this.saveToStorage()
      return project
    },
    
    // 删除原来的 createProject 方法
    // createProject(name) { ... }  ❌ 删除
  }
})
```

### 新增：requirementPoolStore

```javascript
// src/stores/requirementPool.js
import { defineStore } from 'pinia'

export const useRequirementPoolStore = defineStore('requirementPool', {
  state: () => ({
    requirements: []
  }),
  
  getters: {
    pendingRequirements: (state) => 
      state.requirements.filter(r => r.status === 'pending'),
    
    acceptedRequirements: (state) => 
      state.requirements.filter(r => r.status === 'accepted'),
    
    rejectedRequirements: (state) => 
      state.requirements.filter(r => r.status === 'rejected'),
    
    pendingCount: (state) => 
      state.requirements.filter(r => r.status === 'pending').length
  },
  
  actions: {
    loadFromStorage() {
      const data = localStorage.getItem('requirement-pool')
      if (data) {
        this.requirements = JSON.parse(data)
      }
    },
    
    saveToStorage() {
      localStorage.setItem('requirement-pool', JSON.stringify(this.requirements))
    },
    
    addRequirement(requirement) {
      this.requirements.unshift(requirement)
      this.saveToStorage()
    },
    
    updateRequirement(requirement) {
      const index = this.requirements.findIndex(r => r.id === requirement.id)
      if (index !== -1) {
        this.requirements[index] = requirement
        this.saveToStorage()
      }
    },
    
    deleteRequirement(id) {
      this.requirements = this.requirements.filter(r => r.id !== id)
      this.saveToStorage()
    }
  }
})
```

---

## 🗺️ 路由改造

```javascript
// src/router/index.js
const routes = [
  {
    path: '/',
    name: 'Home',
    component: () => import('@/views/Home.vue')
  },
  {
    path: '/requirement-pool',  // ⭐ 新增
    name: 'RequirementPool',
    component: () => import('@/views/RequirementPool.vue')
  },
  {
    path: '/public-form',
    name: 'PublicRequirement',
    component: () => import('@/views/PublicRequirement.vue'),
    meta: { public: true }
  },
  {
    path: '/prd',
    name: 'PRD',
    component: () => import('@/views/PRD.vue')
  },
  // ... 其他路由
]

// ❌ 删除的路由
// /requirement - RequirementForm.vue
// /submissions - Submissions.vue
```

---

## ✅ 实施步骤

### 阶段1：数据清理和准备
1. ✅ 清空 localStorage 的 projects 数据
2. ✅ 创建 requirement-pool 存储结构
3. ✅ 创建 requirementPoolStore

### 阶段2：核心页面开发
1. ✅ 创建 RequirementPool.vue
2. ✅ 修改 PublicRequirement.vue（添加字段）
3. ✅ 修改 Home.vue（移除创建项目）

### 阶段3：功能整合
1. ✅ 修改 projectStore（添加从需求创建项目）
2. ✅ 修改 App.vue（侧边栏菜单）
3. ✅ 修改路由配置

### 阶段4：测试和优化
1. ✅ 完整流程测试
2. ✅ 移动端适配
3. ✅ 性能优化

---

## 📝 注意事项

### 数据清理
- 首次部署需要清空 localStorage 的 projects 数据
- 提示用户：这是重大更新，会清空现有项目

### 向后兼容
- 不需要兼容旧数据（用户已确认删除）
- 新流程完全替代旧流程

### 移动端优化
- 需求池卡片在手机上要能正常显示
- 操作按钮要适配触摸操作

---

**准备开始实施** ✅  
**预计完成时间**：2-3小时  
**测试时间**：30分钟

需要我现在开始实施吗？
