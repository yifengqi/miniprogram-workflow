# 新功能使用说明

## ✨ 更新内容

本次更新解决了两个问题，并新增了客户需求收集功能。

---

## 🔧 问题修复

### 1. API连接测试错误优化

**问题**：使用中转站API时显示 `Unexpected token '<', "<!doctype "... is not valid JSON`

**解决**：
- ✅ 增加了响应类型检查
- ✅ 提供清晰的错误提示
- ✅ 帮助快速定位API配置问题

**使用建议**：
1. 确保API端点URL完整正确（包括完整路径）
2. 检查API Key是否有效
3. 查看错误提示中的HTTP状态码

---

## 🎯 新功能：客户需求收集

### 功能1：公共需求收集表单

**访问路径**：`/public-form`

**特点**：
- ✅ 无需登录，任何人都可访问
- ✅ 支持电脑、手机网页访问
- ✅ 自动保存草稿，不怕中途退出
- ✅ 提交后生成唯一ID

**使用步骤**：
1. 访问 `https://你的域名/public-form`
2. 分7个步骤填写项目需求
3. 可随时点击"保存草稿"
4. 完成后点击"提交"
5. 记录生成的提交ID（用于后续查询）

### 功能2：客户提交管理

**访问路径**：导航栏 → 客户提交

**功能**：
- 📋 查看所有客户提交的需求
- 🔍 搜索功能（按项目名、联系方式）
- 📄 查看详情（Markdown格式）
- 💾 导出Markdown文件
- 📥 一键导入到项目
- 🔗 复制表单链接
- 📱 生成二维码（扫码填写）

**使用步骤**：

#### 分享给客户（方式1：链接）
1. 进入"客户提交"页面
2. 点击"复制表单链接"
3. 将链接发给客户（微信、邮件等）
4. 客户点击链接即可填写

#### 分享给客户（方式2：二维码）
1. 进入"客户提交"页面
2. 点击"生成二维码"
3. 保存二维码或展示给客户
4. 客户用微信扫码即可填写

#### 查看和导入客户提交
1. 客户提交后，在"客户提交"页面可以看到记录
2. 点击"查看详情"可以查看完整需求
3. 点击"导入项目"自动创建新项目并导入需求
4. 导入后可直接进入"需求收集"页面继续编辑

---

## 📱 移动端支持

公共需求表单已针对移动端优化：
- 响应式布局，自动适配屏幕
- 按钮垂直排列，方便点击
- 步骤指示器简化显示
- 表单控件触摸友好

**最佳实践**：
- 电脑端：更适合查看详情和管理
- 手机端：更适合快速填写需求

---

## 💾 数据存储说明

### 本地存储
所有数据存储在浏览器的localStorage中：

1. **客户提交数据** (`public_submissions`)
   - 所有客户通过公共表单提交的需求
   - 包含提交ID、需求详情、提交时间

2. **表单草稿** (`public_requirement_draft`)
   - 客户填写过程中的草稿
   - 提交或重置后自动清除

3. **项目数据** (原有功能)
   - 导入到项目后，存储在项目管理系统中

### 数据安全
- ✅ 所有数据仅存储在本地浏览器
- ✅ 不会上传到服务器
- ✅ 建议定期导出备份（设置→导出数据）

---

## 🔄 完整工作流程

```
1. 分享表单给客户
   ↓
2. 客户填写需求（可分多次完成）
   ↓
3. 客户提交（生成唯一ID）
   ↓
4. 在"客户提交"页面查看
   ↓
5. 导入到项目
   ↓
6. 使用AI生成PRD
   ↓
7. 继续正常开发流程
```

---

## ❓ 常见问题

### Q1：客户填写到一半退出了，数据会丢失吗？
A：不会。表单有自动草稿功能，再次打开会自动加载。建议客户定期点击"保存草稿"。

### Q2：如何追踪哪个客户提交了需求？
A：每个提交都有唯一ID（格式：REQ-时间戳-随机码），同时需求中包含客户的联系方式。

### Q3：可以让多个客户同时填写吗？
A：可以。每个客户打开的是独立的页面，互不影响。

### Q4：客户提交后我没有收到通知怎么办？
A：目前数据存储在本地，需要手动进入"客户提交"页面查看。建议定期检查或让客户提交后告知你。

### Q5：表单链接可以自定义吗？
A：表单路径固定为 `/public-form`，但你可以：
- 使用自己的域名部署
- 使用短链接服务生成短网址
- 直接分享二维码

### Q6：API连接测试总是失败怎么办？
A：请检查：
1. API端点URL是否完整（包括 `/v1/chat/completions` 等路径）
2. API Key是否正确且有效
3. 中转站服务是否正常运行
4. 查看错误提示中的具体信息

---

## 📝 快速参考

### 重要路径
- 公共表单：`/public-form`
- 提交管理：`/submissions`（导航栏）

### 重要操作
- 复制链接：客户提交页 → 复制表单链接
- 生成二维码：客户提交页 → 生成二维码
- 导入项目：客户提交页 → 查看详情 → 导入到项目

---

**更新时间**：2026-02-06  
**版本**：v1.1.0

如有其他问题，请查看完整的「开发问题记录.md」文档。
