# 问题4：需求收集流程优化

**发现时间**：2026-02-06  
**问题类型**：交互流程优化

---

## 📋 问题描述

### 当前存在的问题

#### 问题1：公共表单分享入口位置不合理
**现状**：复制链接和生成二维码功能放在了"客户提交"页面

**问题**：
- 用户需要先进入客户提交页面才能分享表单
- 不够直观，增加操作步骤
- 应该在项目卡片上直接操作

**期望位置**：
1. ✅ 项目首页 - 每个项目卡片里
2. ✅ 需求收集页 - 项目列表里

---

#### 问题2：需求收集页结构不合理
**现状**：直接进入当前项目的需求收集表单

**问题**：
- 没有项目选择界面
- 只能收集当前项目的需求
- 不够灵活

**期望流程**：
```
进入需求收集页
    ↓
显示所有项目列表（每个项目一行）
    ↓
点击某个项目
    ↓
进入该项目的需求收集表单
```

---

#### 问题3：客户提交记录展示不完善
**现状**：只显示已提交的记录

**需要优化**：
- 需要区分「草稿」和「正式提交」
- 草稿：客户填写到一半但未提交
- 正式提交：客户点击了提交按钮

---

## 💡 解决方案设计

### 方案1：项目卡片添加分享功能

**位置**：Home.vue - 项目卡片

**功能设计**：
```vue
<div class="project-card">
  <div class="project-card__header">
    <h3>项目名称</h3>
    <el-dropdown>
      <el-dropdown-menu>
        <el-dropdown-item>重命名</el-dropdown-item>
        <el-dropdown-item>分享需求表单</el-dropdown-item>  <!-- 新增 -->
        <el-dropdown-item>删除</el-dropdown-item>
      </el-dropdown-menu>
    </el-dropdown>
  </div>
  
  <!-- 或者在卡片底部添加快捷操作 -->
  <div class="project-card__actions">
    <el-button size="small">进入项目</el-button>
    <el-button size="small">分享表单</el-button>  <!-- 新增 -->
  </div>
</div>
```

**二级菜单**：
- 复制链接
- 生成二维码

---

### 方案2：需求收集页改为项目列表

**位置**：RequirementForm.vue

**新结构设计**：

#### 第一层：项目列表视图
```vue
<div class="requirement-projects">
  <div class="page-header">
    <h1>需求收集</h1>
    <p>选择一个项目开始收集需求</p>
  </div>
  
  <div class="projects-list">
    <div v-for="project in projects" class="project-item">
      <div class="project-info">
        <h3>{{ project.name }}</h3>
        <p>更新于 {{ project.updatedAt }}</p>
      </div>
      <div class="project-actions">
        <el-button type="primary" @click="goToRequirement(project)">
          收集需求
        </el-button>
        <el-dropdown>
          <el-button>
            <el-icon><Share /></el-icon>
            分享表单
          </el-button>
          <template #dropdown>
            <el-dropdown-menu>
              <el-dropdown-item @click="copyLink(project)">
                复制链接
              </el-dropdown-item>
              <el-dropdown-item @click="showQRCode(project)">
                生成二维码
              </el-dropdown-item>
            </el-dropdown-menu>
          </template>
        </el-dropdown>
      </div>
    </div>
  </div>
</div>
```

#### 第二层：需求收集表单
点击"收集需求"后，显示具体的多步骤表单（当前已有）

---

### 方案3：客户提交记录优化

**位置**：Submissions.vue 和 PublicRequirement.vue

#### 3.1 草稿和正式提交的区分

**数据结构**：
```javascript
{
  id: 'submission-xxx',
  projectId: 'project-xxx',  // 新增：关联项目
  data: { /* 表单数据 */ },
  status: 'draft',  // 新增：draft(草稿) | submitted(已提交)
  savedAt: Date,    // 草稿保存时间
  submittedAt: Date // 正式提交时间
}
```

#### 3.2 提交页面展示

**选项A：使用标签页区分**
```vue
<el-tabs v-model="activeTab">
  <el-tab-pane label="正式提交" name="submitted">
    <!-- 显示已提交的记录 -->
  </el-tab-pane>
  <el-tab-pane label="草稿" name="draft">
    <!-- 显示草稿记录 -->
  </el-tab-pane>
</el-tabs>
```

**选项B：在表格中用状态列区分**
```vue
<el-table-column label="状态">
  <template #default="{ row }">
    <el-tag v-if="row.status === 'submitted'" type="success">
      已提交
    </el-tag>
    <el-tag v-else type="info">
      草稿
    </el-tag>
  </template>
</el-table-column>
```

**推荐**：选项B更简洁，一眼能看到所有记录

#### 3.3 公共表单的草稿保存

**策略**：
- 使用 `localStorage` 的不同 key 区分：
  - `public-form-draft` - 当前正在编辑的草稿（单个）
  - `public-form-submissions` - 已提交的记录（数组）
- 每次填写自动保存到 draft
- 点击提交时，移动到 submissions 并标记为 submitted

---

## 🎯 实施计划

### 优先级

#### P0（必须立即做）
1. ✅ 需求收集页改为项目列表视图
2. ✅ 项目列表中添加分享表单功能

#### P1（本次一起做）
3. ✅ 项目卡片添加分享快捷入口
4. ✅ 客户提交记录添加状态区分

#### P2（可以后续优化）
5. 草稿自动清理（7天后）
6. 批量操作（批量删除、批量导入）

---

## 📐 技术实现要点

### 1. 路由调整

**当前**：
```javascript
{
  path: '/requirement',
  component: RequirementForm  // 直接显示表单
}
```

**修改后**：
```javascript
{
  path: '/requirement',
  component: RequirementList  // 项目列表
},
{
  path: '/requirement/:projectId',
  component: RequirementForm  // 具体表单
}
```

### 2. 组件拆分

**原 RequirementForm.vue**：
- 拆分为 `RequirementList.vue`（项目列表）
- 保留 `RequirementForm.vue`（表单）

或者：
- 在 RequirementForm.vue 内部用 `v-if` 切换两种视图
- 推荐这种方式，更简单

### 3. 数据结构调整

**客户提交记录**：
```javascript
// localStorage key: public-submissions
[
  {
    id: 'sub-20260206-001',
    projectId: null,  // 公共表单可能没有关联项目
    status: 'submitted',  // draft | submitted
    data: { /* 表单数据 */ },
    savedAt: '2026-02-06 10:00:00',
    submittedAt: '2026-02-06 10:30:00'
  }
]

// localStorage key: public-form-draft
{
  id: 'draft-temp',
  status: 'draft',
  data: { /* 当前编辑的数据 */ },
  savedAt: '2026-02-06 10:15:00'
}
```

---

## 🎨 UI/UX 优化建议

### 1. 项目列表视图
- 使用卡片式布局，每行一个项目
- 显示项目基本信息和操作按钮
- 突出显示"分享表单"功能

### 2. 分享功能
- 统一的分享弹窗组件
- 包含：复制链接、二维码、分享说明
- 可以在多处复用

### 3. 客户提交记录
- 草稿用灰色标签，正式提交用绿色标签
- 草稿可以"继续编辑"（跳转到公共表单并恢复数据）
- 正式提交可以"查看详情"和"导入项目"

---

## ✅ 验收标准

### 功能验收
- [ ] 项目首页卡片可以分享表单
- [ ] 需求收集页先显示项目列表
- [ ] 项目列表中可以分享表单
- [ ] 点击项目进入需求收集表单
- [ ] 客户提交记录区分草稿和正式提交
- [ ] 草稿可以继续编辑
- [ ] 所有分享功能统一，生成正确的链接

### 体验验收
- [ ] 操作流程顺畅，不需要多余步骤
- [ ] 分享入口明显，容易找到
- [ ] 草稿和提交状态一目了然
- [ ] 移动端适配良好

---

## 📝 后续优化方向

1. **项目关联**：公共表单可以选择关联到具体项目
2. **通知提醒**：有新提交时浏览器通知
3. **数据统计**：查看表单填写率、完成率
4. **表单自定义**：不同项目可以自定义收集字段
5. **批量操作**：批量导入、批量删除

---

**创建时间**：2026-02-06  
**问题状态**：🔨 进行中  
**预计完成**：2026-02-06

---

## 更新记录

- 2026-02-06 10:00 - 创建问题文档
- 2026-02-06 10:30 - 完成解决方案设计
- 2026-02-06 11:00 - ✅ 完成需求收集页项目列表视图改造
- 2026-02-06 11:00 - ✅ 完成项目列表中的分享表单功能
- 2026-02-06 11:00 - ✅ 完成项目首页卡片的分享功能
- 待完成：客户提交记录状态区分

---

## 🎉 已完成功能

### 1. 需求收集页改造 ✅

**实现方式**：使用 `v-if` 在同一组件内切换两种视图

#### 项目列表视图
- 显示所有项目，每行一个项目卡片
- 显示项目基本信息：名称、更新时间、是否已收集需求
- 提供两个主要操作：
  - "收集需求"按钮 → 进入该项目的需求表单
  - "分享表单"下拉菜单 → 复制链接 / 生成二维码

#### 需求表单视图
- 点击"收集需求"后显示
- 顶部显示"返回项目列表"按钮
- 显示当前项目名称
- 保留原有的7步骤表单功能

### 2. 项目首页分享功能 ✅

**位置**：Home.vue - 项目卡片下拉菜单

**新增功能**：
- 在卡片的"更多"菜单中新增"分享需求表单"选项
- 点击后弹出分享弹窗
- 弹窗提供：
  - 复制链接按钮
  - 生成二维码按钮（点击后显示二维码）
  - 下载二维码按钮
  - 使用说明提示

**交互流程**：
```
点击项目卡片"更多"
  ↓
选择"分享需求表单"
  ↓
弹出分享弹窗
  ↓
选择"复制链接"或"生成二维码"
```

### 3. 技术实现要点

#### 组件设计
- 没有拆分组件，在 RequirementForm.vue 内用 `v-if` 切换视图
- 使用 `selectedProject` 状态控制显示哪个视图
- 共用相同的表单数据和二维码生成逻辑

#### 状态管理
```javascript
selectedProject: null     // null = 显示项目列表
selectedProject: project  // 有值 = 显示表单
```

#### 数据保存
- 进入项目时从 `project.requirement` 加载已有数据
- 保存时仍然保存到当前项目

#### 分享功能复用
- Home.vue 和 RequirementForm.vue 都可以分享表单
- 使用相同的公共表单 URL
- 相同的二维码生成逻辑

---

## 📸 功能截图（概念）

### 需求收集页 - 项目列表视图
```
┌─────────────────────────────────────────┐
│  需求收集                                 │
│  选择一个项目开始收集需求，或分享表单给客户 │
├─────────────────────────────────────────┤
│  ┌────────────────────────────────────┐ │
│  │ 星见小程序            更新于 2天前   │ │
│  │ [已收集需求]                         │ │
│  │                                      │ │
│  │  [收集需求]  [分享表单 ▼]            │ │
│  └────────────────────────────────────┘ │
│  ┌────────────────────────────────────┐ │
│  │ 旅游预订系统          更新于 5天前   │ │
│  │ [未收集]                             │ │
│  │                                      │ │
│  │  [收集需求]  [分享表单 ▼]            │ │
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 项目首页 - 卡片分享功能
```
┌────────────────────┐
│ 星见小程序      [⋮] │
│                    │
│ 更多菜单：          │
│ • 重命名            │
│ • 分享需求表单 ⭐   │
│ • 删除              │
└────────────────────┘
```

---
